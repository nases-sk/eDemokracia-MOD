this.ckan.module("resource-reorder",function(e,i){return{options:{id:!1,i18n:{label:i("Reorder resources"),save:i("Save order"),saving:i("Saving..."),cancel:i("Cancel")}},template:{title:"<h1></h1>",button:['<a href="javascript:;" class="btn">','<i class="icon-reorder"></i>',"<span></span>","</a>"].join("\n"),form_actions:['<div class="form-actions">','<a href="javascript:;" class="cancel btn pull-left"></a>','<a href="javascript:;" class="save btn btn-primary"></a>',"</div>"].join("\n"),handle:['<a href="javascript:;" class="handle">','<i class="icon-move"></i>',"</a>"].join("\n"),saving:['<span class="saving muted m-right">','<i class="icon-spinner icon-spin"></i>',"<span></span>","</span>"].join("\n")},is_reordering:!1,cache:!1,initialize:function(){jQuery.proxyAll(this,/_on/),this.html_title=e(this.template.title).text(this.i18n("label")).insertBefore(this.el).hide();var i=e(this.template.button).on("click",this._onHandleStartReorder).appendTo(".page_primary_action");e("span",i).text(this.i18n("label")),this.html_form_actions=e(this.template.form_actions).hide().insertAfter(this.el),e(".save",this.html_form_actions).text(this.i18n("save")).on("click",this._onHandleSave),e(".cancel",this.html_form_actions).text(this.i18n("cancel")).on("click",this._onHandleCancel),this.html_handles=e(this.template.handle).hide().appendTo(e(".resource-item",this.el)),this.html_saving=e(this.template.saving).hide().insertBefore(e(".save",this.html_form_actions)),e("span",this.html_saving).text(this.i18n("saving")),this.cache=this.el.html(),this.el.sortable().sortable("disable")},_onHandleStartReorder:function(){this.is_reordering||(this.html_form_actions.add(this.html_handles).add(this.html_title).show(),this.el.addClass("reordering").sortable("enable"),e(".page_primary_action").hide(),this.is_reordering=!0)},_onHandleCancel:function(){this.is_reordering&&!e(".cancel",this.html_form_actions).hasClass("disabled")&&(this.reset(),this.is_reordering=!1,this.el.html(this.cache).sortable().sortable("disable"),this.html_handles=e(".handle",this.el))},_onHandleSave:function(){if(!e(".save",this.html_form_actions).hasClass("disabled")){var i=this;i.html_saving.show(),e(".save, .cancel",i.html_form_actions).addClass("disabled");var t=[];e(".resource-item",i.el).each(function(){t.push(e(this).data("id"))}),i.sandbox.client.call("POST","package_resource_reorder",{id:i.options.id,order:t},function(){i.html_saving.hide(),e(".save, .cancel",i.html_form_actions).removeClass("disabled"),i.cache=i.el.html(),i.reset(),i.is_reordering=!1})}},reset:function(){this.html_form_actions.add(this.html_handles).add(this.html_title).hide(),this.el.removeClass("reordering").sortable("disable"),e(".page_primary_action").show()}}});