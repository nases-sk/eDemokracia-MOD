this.ckan.module("image-upload",function(t,i){return{options:{is_url:!0,is_upload:!1,field_upload:"image_upload",field_url:"image_url",field_clear:"clear_upload",upload_label:"",i18n:{upload:i("Upload"),url:i("Link"),remove:i("Remove"),upload_label:i("Image"),upload_tooltip:i("Upload a file on your computer"),url_tooltip:i("Link to a URL on the internet (you can also link to an API)"),remove_tooltip:i("Reset this")},template:[""].join("\n")},state:{attached:1,blank:2,web:3},initialize:function(){t.proxyAll(this,/_on/);var i=this.options,e='input[name="'+i.field_upload+'"]',a='input[name="'+i.field_url+'"]',o='input[name="'+i.field_clear+'"]';this.input=t(e,this.el),this.field_url=t(a,this.el).parents(".control-group"),this.field_image=this.input.parents(".control-group");var s=t(o,this.el);s.length>0&&(i.is_upload=!0,s.parents(".control-group").remove()),this.field_clear=t('<input type="hidden" name="clear_upload">').appendTo(this.el),this.button_url=t('<a href="javascript:;" class="btn"><i class="icon-globe"></i> '+this.i18n("url")+"</a>").prop("title",this.i18n("url_tooltip")).on("click",this._onFromWeb).insertAfter(this.input),this.button_upload=t('<a href="javascript:;" class="btn"><i class="icon-cloud-upload"></i>'+this.i18n("upload")+"</a>").insertAfter(this.input),this.button_remove=t('<a href="javascript:;" class="btn btn-danger" />').text(this.i18n("remove")).on("click",this._onRemove).insertAfter(this.button_upload),t('<a href="javascript:;" class="btn btn-danger btn-remove-url"><i class="icon-remove"></i></a>').prop("title",this.i18n("remove_tooltip")).on("click",this._onRemove).insertBefore(t("input",this.field_url)),t('label[for="field-image-upload"]').text(i.upload_label||this.i18n("upload_label")),this.input.on("mouseover",this._onInputMouseOver).on("mouseout",this._onInputMouseOut).on("change",this._onInputChange).prop("title",this.i18n("upload_tooltip")).css("width",this.button_upload.outerWidth()),this.fields=t("<i />").add(this.button_remove).add(this.button_upload).add(this.button_url).add(this.input).add(this.field_url).add(this.field_image),i.is_url?this.changeState(this.state.web):i.is_upload?this.changeState(this.state.attached):this.changeState(this.state.blank)},changeState:function(t){this.fields.hide(),t==this.state.blank?this.button_upload.add(this.field_image).add(this.button_url).add(this.input).show():t==this.state.attached?this.button_remove.add(this.field_image).show():t==this.state.web&&this.field_url.show()},_onFromWeb:function(){this.changeState(this.state.web),t("input",this.field_url).focus(),this.options.is_upload&&this.field_clear.val("true")},_onRemove:function(){this.changeState(this.state.blank),t("input",this.field_url).val(""),this.field_clear.val("true")},_onInputChange:function(){this.file_name=this.input.val(),this.field_clear.val(""),this.changeState(this.state.attached)},_onInputMouseOver:function(){this.button_upload.addClass("hover")},_onInputMouseOut:function(){this.button_upload.removeClass("hover")}}});