this.ckan.module("reclinepreview",function(e,i){return{options:{i18n:{errorLoadingPreview:"Could not load preview",errorDataProxy:"DataProxy returned an error",errorDataStore:"DataStore returned an error",previewNotAvailableForDataType:"Preview not available for data type: "},site_url:""},initialize:function(){e.proxyAll(this,/_on/),this.el.ready(this._onReady),L.Icon.Default.imagePath=this.options.site_url+"vendor/leaflet/0.4.4/images"},_onReady:function(){this.loadPreviewDialog(preload_resource)},loadPreviewDialog:function(a){function r(e){e=e||i("error loading preview"),window.parent.ckan.pubsub.publish("data-viewer-error",e)}var o=this;if(recline.Backend.DataProxy.timeout=1e4,recline.Backend.DataProxy.dataproxy_url="//jsonpdataproxy.appspot.com",a.formatNormalized=this.normalizeFormat(a.format),""===a.formatNormalized){var t=a.url.split("/");t=t[t.length-1],t=t.split("?"),t=t[0];var n=t.split(".");n.length>1&&(a.formatNormalized=n[n.length-1])}var l,d;a.datastore_active?(a.backend="ckan",a.endpoint=e("body").data("site-root")+"api",d=new recline.Model.Dataset(a),l=this.options.i18n.errorLoadingPreview+": "+this.options.i18n.errorDataStore,d.fetch().done(function(e){o.initializeDataExplorer(e)}).fail(function(e){e.message&&(l+=" ("+e.message+")"),r(l)})):a.formatNormalized in{csv:"",xls:""}&&(a.format=a.formatNormalized,a.backend="dataproxy",d=new recline.Model.Dataset(a),l=this.options.i18n.errorLoadingPreview+": "+this.options.i18n.errorDataProxy,d.fetch().done(function(i){i.bind("query:fail",function(){e(".data-view-container",o.el).hide(),e(".header",o.el).hide()}),o.initializeDataExplorer(i)}).fail(function(e){e.message&&(l+=" ("+e.message+")"),r(l)}))},initializeDataExplorer:function(e){{var i=[{id:"grid",label:"TabuÄ¾ka",view:new recline.View.SlickGrid({model:e})},{id:"graph",label:"Graf",view:new recline.View.Graph({model:e})},{id:"map",label:"Mapa",view:new recline.View.Map({model:e})}],a=[{id:"valueFilter",label:"Filtre",view:new recline.View.ValueFilter({model:e})}];new recline.View.MultiView({el:this.el,model:e,views:i,sidebarViews:a,config:{readOnly:!0}})}},normalizeFormat:function(e){var i=e.toLowerCase();return i=i.split("/"),i=i[i.length-1]}}});